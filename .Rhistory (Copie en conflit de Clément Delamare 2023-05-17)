gc()
analyse_dixon_sp
analyse_dixon_sp[analyse_dixon_sp != 0]
analyse_dixon_sp != 0
analyse_dixon_sp
analyse_dixon_sp[analyse_dixon_sp != 0]
analyse_dixon_sp != 0
analyse_dixon_sp     <- analyse_dixon_sp[analyse_dixon_sp != 0, ]
gc()
gc()
analyse_dixon_sp[analyse_dixon_sp != 0]
targets::tar_load(analyse_dixon)
analyse_dixon        <- sf::st_drop_geometry(analyse_dixon)
targets::tar_load(analyse_dixon)
analyse_dixon        <- sf::st_drop_geometry(analyse_dixon)
analyse_dixon_sp     <- analyse_dixon[, !(names(analyse_dixon) %in% c("regions", "present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4"))]
analyse_dixon_sp
analyse_dixon_sp[analyse_dixon_sp != 0]
analyse_dixon !=0
analyse_dixon_sp !=0
gc()
analyses_dixon[analyse_dixon_sp !=0]
analyse_dixon        <- sf::st_drop_geometry(analyse_dixon)
analyse_dixon_sp     <- analyse_dixon[, !(names(analyse_dixon) %in% c("regions", "present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4"))]
sum_area_sp          <- colSums(analyse_dixon_sp)
sp_nomatch           <- names(sum_area_sp)[sum_area_sp == 0]
analyse_dixon        <- analyse_dixon[, !(names(analyse_dixon) %in% sp_nomatch)]
gc()
targets::tar_load(analyse_dixon)
analyse_dixon        <- sf::st_drop_geometry(analyse_dixon)
analyse_dixon_sp     <- analyse_dixon[, !(names(analyse_dixon) %in% c("regions", "present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4"))]
sum_area_sp          <- colSums(analyse_dixon_sp)
sp_nomatch           <- names(sum_area_sp)[sum_area_sp == 0]
analyse_dixon        <- analyse_dixon[, !(names(analyse_dixon) %in% sp_nomatch)]
analyse_dixon_sp[analyse_dixon_sp != 0]
analyses_dixon[analyse_dixon_sp !=0 ]
analyse_dixon[analyse_dixon_sp !=0 ]
gc()
analyse_dixon[analyse_dixon != 0]
analyse_dixon != 0
gc()
analyse_dixon <- analyse_dixon[analyse_dixon != 0, sp_names]
analyse_dixon <- analyse_dixon[analyse_dixon != 0, 7:773]
gc()
gc()
dev.new()
dev.new()
targets::tar_load(final_impacts)
final_impacts <- final_impacts[final_impacts$area == "area_exposed", ]
final_impacts <- na.omit(final_impacts)
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_1.5 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_1.5))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_2 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_2))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_3 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_3))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_4 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_4))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_threshold <- cowplot::ggdraw(xlim = c(0, 40), ylim = c(0, 40))+
cowplot::draw_plot(boxplot_impact_present, x = 0, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_1.5, x = 20, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_2, x = 0, y = 0, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_3, x = 20, y = 0, width = 20, height = 20)
boxplot_threshold
targets::tar_load(final_impacts)
global_exposed <- final_impacts[final_impacts$area == "area_exposed", ]
total_nb_sp <- tapply(global_exposed$specie, as.factor(global_exposed$family), length)
present_50 <- global_exposed[global_exposed$present_stress > 50, ]
targets::tar_load(final_impacts)
final_impacts <- final_impacts[final_impacts$area == "area_exposed", ]
final_impacts <- na.omit(final_impacts)
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_1.5 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_1.5))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_2 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_2))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_3 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_3))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_4 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_4))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_threshold <- cowplot::ggdraw(xlim = c(0, 40), ylim = c(0, 40))+
cowplot::draw_plot(boxplot_impact_present, x = 0, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_1.5, x = 20, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_2, x = 0, y = 0, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_3, x = 20, y = 0, width = 20, height = 20)
boxplot_threshold
dev.new()
boxplot_threshold
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90),
axis.text.y = ggplot2::element_text(angle = 90))+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 180))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = -90))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 180))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = -180))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 180))
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = -180))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 180))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()+
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 90))
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_present
boxplot_impact_present <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = present_stress))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_1.5 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_1.5))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_2 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_2))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_3 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_3))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_impact_4 <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = forcats::fct_rev(as.factor(family)), y = stress_4))+
ggplot2::theme_classic()+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 0, ymax = 10), fill = "lightblue", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 10, ymax = 20), fill = "lightgoldenrod", alpha = 0.06)+
ggplot2::geom_rect(ggplot2::aes(xmin = -Inf, xmax = Inf, ymin = 20, ymax = 100), fill = "tomato", alpha = 0.06)+
ggplot2::geom_boxplot(alpha = 0.5)+
ggplot2::xlab("")+
ggplot2::ylab("% d'exposition du range au stress thermique")+
ggplot2::coord_flip()
boxplot_threshold <- cowplot::ggdraw(xlim = c(0, 40), ylim = c(0, 40))+
cowplot::draw_plot(boxplot_impact_present, x = 0, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_1.5, x = 20, y = 20, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_2, x = 0, y = 0, width = 20, height = 20)+
cowplot::draw_plot(boxplot_impact_3, x = 20, y = 0, width = 20, height = 20)
boxplot_threshold
tail(targets::tar_read(final_taxonomy))
targets::tar_load(analyse_dixon)
targets::tar_load(final_taxonomy)
analyse_dixon        <- sf::st_drop_geometry(analyse_dixon)
analyse_dixon_sp     <- analyse_dixon[, !names(analyse_dixon) %in% c("regions", "present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4")]
sum_area_sp          <- colSums(analyse_dixon_sp)
sp_nomatch           <- names(sum_area_sp)[sum_area_sp == 0]
analyse_dixon        <- analyse_dixon[, ! (names(analyse_dixon) %in% sp_nomatch)]
sp_impacts <- lapply(7:ncol(analyse_dixon), function(sp){
#sp = 205
message(sp)
select_sp    <- analyse_dixon[, c(1:6, sp)]
sp_name      <- colnames(select_sp)[7]
sp_family    <- final_taxonomy$final_family[final_taxonomy$final_genus_sp %in% sp_name]
if(length(sp_family) == 0) {sp_family <- 0}
sp_range     <- select_sp[select_sp[, 7] == 1, ]
area_range   <- nrow(sp_range)
heat_stress  <- sp_range[, 2:6]
level_stress <- colnames(heat_stress)
area_impacts <- sapply(1:ncol(heat_stress), function(level){
#level = 1
heat_stress <- heat_stress[, level]
area_refuge <- length(heat_stress[heat_stress <= 0.1])
area_intermediate <- length(heat_stress[heat_stress > 0.1 & heat_stress <= 0.2])
area_exposed <- length(heat_stress[heat_stress > 0.2])
list_area <- list(area_refuge,
area_intermediate,
area_exposed)
return(list_area)
})
sp_area_impacts <- data.frame(do.call(cbind, as.data.frame(area_impacts)))
colnames(sp_area_impacts) <- level_stress
sp_area_impacts$area <- c("area_refuge", "area_intermediate", "area_exposed")
sp_area_impacts$specie <- rep(sp_name, nrow(sp_area_impacts))
sp_area_impacts$family  <- rep(sp_family, nrow(sp_area_impacts))
sp_area_impacts <- sp_area_impacts[, c("specie", "family", "area", "present_stress",
"stress_1.5", "stress_2", "stress_3", "stress_4")]
return(sp_area_impacts)
})
area_impacts
sp_impacts
final_impacts <- data.frame(do.call(rbind, sp_impacts))
final_impacts$present_stress <- as.integer(final_impacts$present_stress)
final_impacts$stress_1.5 <- as.integer(final_impacts$stress_1.5)
final_impacts$stress_2   <- as.integer(final_impacts$stress_2)
final_impacts$stress_3   <- as.integer(final_impacts$stress_3)
final_impacts$stress_4   <- as.integer(final_impacts$stress_4)
sp = "Acropora_abrotanoides"
#sp = "Acropora_abrotanoides"
message(sp)
specie      <- final_impacts[final_impacts$specie == sp, ]
sp_name     <- specie$specie
family_name <- unique(specie$family)
stress <- specie[, 4:8]
range  <- unique(apply(stress, 2, sum))
range
percentage_impacts <- specie |>
dplyr::group_by(area) |>
dplyr::summarise(present_stress = (present_stress * 100) / range,
stress_1.5 = (stress_1.5 * 100) / range,
stress_2 = (stress_2 * 100) / range,
stress_3 = (stress_3 * 100) / range,
stress_4 = (stress_4 * 100) / range)
percentage_impacts <- data.frame(cbind(specie = sp_name,
family = family_name,
percentage_impacts))
percentage_impacts
#sp = "Acropora_abrotanoides"
message(sp)
specie      <- final_impacts[final_impacts$specie == sp, ]
sp_name     <- specie$specie
family_name <- unique(specie$family)
stress <- specie[, 4:8]
range  <- unique(apply(stress, 2, sum))
percentage_impacts <- specie |>
dplyr::group_by(area) |>
dplyr::summarise(present_stress = (present_stress * 100) / range,
stress_1.5 = (stress_1.5 * 100) / range,
stress_2 = (stress_2 * 100) / range,
stress_3 = (stress_3 * 100) / range,
stress_4 = (stress_4 * 100) / range)
percentage_impacts <- data.frame(cbind(specie = sp_name,
family = family_name,
range,
percentage_impacts))
percentage_impacts
targets::tar_visnetwork(targets_only = T)
#targets::tar_visnetwork(targets_only = T)
targets::tar_make()
targets::tar_load(final_impacts)
final_impacts
final_impacts <- final_impacts[final_impacts$area == "area_exposed", ]
final_impacts <- final_impacts[final_impacts$area == "area_exposed", ]
final_impacts <- na.omit(final_impacts)
plot(final_impacts$range, final_impacts$stress_1.5)
plot(final_impacts$range, final_impacts$stress_1.5)
plot(log(final_impacts$range), log(final_impacts$stress_1.5))
plot(final_impacts$range, final_impacts$stress_1.5)
plot(final_impacts$range, final_impacts$present_stress)
targets::tar_load(final_impacts)
final_impacts
corr_range_stress <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = present_stress, y = range, color = family))+
ggplot2::geom_point()
corr_range_stress
final_impacts <- final_impacts[final_impacts$area == "area_exposed", ]
corr_range_stress <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = present_stress, y = range, color = family))+
ggplot2::geom_point()
corr_range_stress
corr_range_stress <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = stress_1.5, y = range, color = family))+
ggplot2::geom_point()
corr_range_stress
final_impacts
corr_range_stress <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = stress_1.5, y = range, color = family))+
ggplot2::geom_point()
corr_range_stress
corr_range_2  <- ggplot2::ggplot(final_impacts, ggplot2::aes(x = stress_2, y = range, color = family))+
ggplot2::geom_point()
corr_range_2
boxplot(final_impacts$present_stress)
boxplot(final_impacts$stress_1.5, add = TRUE)
boxplot(final_impacts$present_stress, final_impacts$stress_1.5, final_impacts$stress_2)
boxplot(final_impacts$present_stress, final_impacts$stress_1.5, final_impacts$stress_2)
apply(final_impacts[, 4:8, 2, quantile])
apply(final_impacts[, 4:8], 2, quantile)
final_impacts[, names(final_impacts) %in% c("present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4")]
thereshold <- final_impacts[, names(final_impacts) %in% c("present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4")]
thereshold
apply(thereshold, 2, quantile)
apply(thereshold, 2, median)
?ggplot2::geom_vline
val_med <- apply(thereshold, 2, median)
val_med[1]
threshold <- final_impacts[, names(final_impacts) %in% c("present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4")]
val_med_range     <- median(final_impacts$range)
val_med_range
threshold <- final_impacts[, names(final_impacts) %in% c("present_stress", "stress_1.5", "stress_2", "stress_3", "stress_4")]
val_med_threshold <- apply(threshold, 2, median)
val_med_range     <- median(final_impacts$range)
corr_range_present<- ggplot2::ggplot(final_impacts, ggplot2::aes(x = present_stress, y = range, color = family))+
ggplot2::geom_point()+
ggplot2::geom_hline(xintercept = val_med_threshold[1])+
ggplot2::geom_vline(yintercept = val_med_range)
class(val_med_range)
corr_range_present
corr_range_present<- ggplot2::ggplot(final_impacts, ggplot2::aes(x = present_stress, y = range, color = family))+
ggplot2::geom_point()+
ggplot2::geom_hline(yintercept = val_med_range)+
ggplot2::geom_vline(xintercept = val_med_threshold[1])
corr_range_present
